var h=(n,i,s)=>new Promise((c,r)=>{var d=a=>{try{o(s.next(a))}catch(l){r(l)}},e=a=>{try{o(s.throw(a))}catch(l){r(l)}},o=a=>a.done?c(a.value):Promise.resolve(a.value).then(d,e);o((s=s.apply(n,i)).next())});import{T as S,X as V,$ as t,U as k,a7 as C,A as x}from"./bootstrap-CmOIY23B.js";import{T as P}from"./auth-title-CCQpxSeU.js";import{d as B,b as R,c as A,m as $,n as y,j as T,D as N,q as E,E as g,z as w,H as p,A as b,u,v as L,x as F,r as _,l as D}from"../jse/index-index-Dn7Pga_E.js";const q={class:"text-muted-foreground"},z=B({name:"AuthenticationCodeLogin",__name:"code-login",props:{formSchema:{},loading:{type:Boolean,default:!1},loginPath:{default:"/auth/login"},title:{default:""},subTitle:{default:""},submitButtonText:{default:""},showBack:{type:Boolean,default:!0}},emits:["submit"],setup(n,{expose:i,emit:s}){const c=n,r=s,d=S(),[e,o]=V(R({commonConfig:{hideLabel:!0,hideRequiredMark:!0},schema:A(()=>c.formSchema),showDefaultActions:!1}));function a(){return h(this,null,function*(){const{valid:m}=yield o.validate(),f=yield o.getValues();m&&r("submit",f)})}function l(){d.push(c.loginPath)}return i({getFormApi:()=>o}),(m,f)=>(y(),$("div",null,[T(P,null,{desc:g(()=>[L("span",q,[w(m.$slots,"subTitle",{},()=>[p(b(n.subTitle||u(t)("authentication.codeSubtitle")),1)])])]),default:g(()=>[w(m.$slots,"title",{},()=>[p(b(n.title||u(t)("authentication.welcomeBack"))+" ðŸ“² ",1)])]),_:3}),T(u(e)),T(u(k),{class:F([{"cursor-wait":n.loading},"w-full"]),loading:n.loading,onClick:a},{default:g(()=>[w(m.$slots,"submitButtonText",{},()=>[p(b(n.submitButtonText||u(t)("common.login")),1)])]),_:3},8,["class","loading"]),n.showBack?(y(),N(u(k),{key:0,class:"mt-4 w-full",variant:"outline",onClick:f[0]||(f[0]=H=>l())},{default:g(()=>[p(b(u(t)("common.back")),1)]),_:1})):E("",!0)]))}}),v=6,O=B({name:"CodeLogin",__name:"code-login",setup(n){const i=_(!1),s=D("loginRef");function c(e){return x.loading({content:t("page.auth.sendingCode"),duration:0,key:"sending-code"}),new Promise(o=>{setTimeout(()=>{x.success({content:t("page.auth.codeSentTo",[e]),duration:3,key:"sending-code"}),o({code:"123456",phoneNumber:e})},3e3)})}const r=A(()=>[{component:"VbenInput",componentProps:{placeholder:t("authentication.mobile")},fieldName:"phoneNumber",label:t("authentication.mobile"),rules:C().min(1,{message:t("authentication.mobileTip")}).refine(e=>/^\d{11}$/.test(e),{message:t("authentication.mobileErrortip")})},{component:"VbenPinInput",componentProps:{codeLength:v,createText:e=>e>0?t("authentication.sendText",[e]):t("authentication.sendCode"),handleSendCode:()=>h(null,null,function*(){var l;i.value=!0;const e=(l=s.value)==null?void 0:l.getFormApi();if(!e)throw i.value=!1,new Error("formApi is not ready");if(yield e.validateField("phoneNumber"),!(yield e.isFieldValid("phoneNumber")))throw i.value=!1,new Error("Phone number is not Ready");const{phoneNumber:a}=yield e.getValues();yield c(a),i.value=!1}),placeholder:t("authentication.code")},fieldName:"code",label:t("authentication.code"),rules:C().length(v,{message:t("authentication.codeTip",[v])})}]);function d(e){return h(this,null,function*(){console.log(e)})}return(e,o)=>(y(),N(u(z),{ref_key:"loginRef",ref:s,"form-schema":r.value,loading:i.value,onSubmit:d},null,8,["form-schema","loading"]))}});export{O as default};
