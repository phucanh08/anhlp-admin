var T=(t,r,u)=>new Promise((m,p)=>{var y=n=>{try{i(u.next(n))}catch(a){p(a)}},s=n=>{try{i(u.throw(n))}catch(a){p(a)}},i=n=>n.done?m(n.value):Promise.resolve(n.value).then(y,s);i((u=u.apply(t,r)).next())});import{af as M,bn as V,$ as o,bo as x,bp as E,al as U,ak as q,ai as F,aj as N,X as j,T as Q,bq as D,U as I,Y as K,Z as O,ad as G,a7 as A,aL as z}from"./bootstrap-CmOIY23B.js";import{_ as Y}from"./index.vue_vue_type_script_setup_true_lang-CcnCQVvY.js";import{T as H}from"./auth-title-CCQpxSeU.js";import{d as S,an as W,m as L,n as d,j as c,E as g,u as e,v,A as f,D as k,q as b,b as X,c as B,r as Z,e as J,z as C,H as _,x as ee,a5 as te,l as oe}from"../jse/index-index-Dn7Pga_E.js";import{v as ne}from"./AlertBuilder-Dz3kGiBI.js";import{u as ae}from"./use-modal-Brudt_15.js";const ie=S({__name:"dingding-login",props:{clientId:{},corpId:{},redirectUri:{},isQrCode:{type:Boolean}},setup(t){const r=t,u=M(),[m,p]=ae({header:!1,footer:!1,fullscreenButton:!1,class:"w-[302px] h-[302px] dingding-qrcode-login-modal",onOpened(){s()}}),y=()=>{const{redirectUri:n}=r;return n||window.location.origin+u.fullPath},s=()=>T(null,null,function*(){const{clientId:n,corpId:a}=r;window.DTFrameLogin||(yield W("https://g.alicdn.com/dingding/h5-dingtalk-login/0.21.0/ddlogin.js")),window.DTFrameLogin({id:"dingding_qrcode_login_element",width:300,height:300},{redirect_uri:encodeURIComponent(y()),client_id:n,scope:"openid corpid",response_type:"code",state:"1",prompt:"consent",corpId:a},h=>{const{redirectUrl:P}=h;window.location.href=P},h=>{ne(`Login Error: ${h}`)})}),i=()=>{const{clientId:n,corpId:a,isQrCode:h}=r;h?p.open():window.location.href=`https://login.dingtalk.com/oauth2/auth?redirect_uri=${encodeURIComponent(y())}&response_type=code&client_id=${n}&scope=openid&corpid=${a}&prompt=consent`};return(n,a)=>(d(),L("div",null,[c(e(x),{onClick:i,tooltip:e(o)("authentication.dingdingLogin"),"tooltip-side":"top"},{default:g(()=>[c(e(V))]),_:1},8,["tooltip"]),c(e(m),null,{default:g(()=>[...a[0]||(a[0]=[v("div",{id:"dingding_qrcode_login_element"},null,-1)])]),_:1})]))}}),se={VITE_GLOB_API_URL:"https://mock-napi.vben.pro/api"},le={class:"w-full sm:mx-auto md:max-w-md"},re={class:"mt-4 flex items-center justify-between"},ce={class:"text-muted-foreground text-center text-xs uppercase"},de={class:"mt-4 flex flex-wrap justify-center"},ue=S({name:"ThirdPartyLogin",__name:"third-party-login",setup(t){const{auth:{dingding:r}}=E(se,!0);return(u,m)=>(d(),L("div",le,[v("div",re,[m[0]||(m[0]=v("span",{class:"border-input w-[35%] border-b dark:border-gray-600"},null,-1)),v("span",ce,f(e(o)("authentication.thirdPartyLogin")),1),m[1]||(m[1]=v("span",{class:"border-input w-[35%] border-b dark:border-gray-600"},null,-1))]),v("div",de,[c(e(x),{tooltip:e(o)("authentication.wechatLogin"),"tooltip-side":"top",class:"mb-3"},{default:g(()=>[c(e(U))]),_:1},8,["tooltip"]),c(e(x),{tooltip:e(o)("authentication.qqLogin"),"tooltip-side":"top",class:"mb-3"},{default:g(()=>[c(e(q))]),_:1},8,["tooltip"]),c(e(x),{tooltip:e(o)("authentication.githubLogin"),"tooltip-side":"top",class:"mb-3"},{default:g(()=>[c(e(F))]),_:1},8,["tooltip"]),c(e(x),{tooltip:e(o)("authentication.googleLogin"),"tooltip-side":"top",class:"mb-3"},{default:g(()=>[c(e(N))]),_:1},8,["tooltip"]),e(r)?(d(),k(ie,{key:0,"corp-id":e(r).corpId,"client-id":e(r).clientId,class:"mb-3"},null,8,["corp-id","client-id"])):b("",!0)])]))}}),me=["onKeydown"],ge={class:"text-muted-foreground"},fe={key:0,class:"mb-6 flex justify-between"},pe={class:"flex-center"},he={key:1,class:"mb-2 mt-4 flex items-center justify-between"},we={key:0,class:"mt-3 text-center text-sm"},be=S({name:"AuthenticationLogin",__name:"login",props:{formSchema:{default:()=>[]},codeLoginPath:{default:"/auth/code-login"},forgetPasswordPath:{default:"/auth/forget-password"},loading:{type:Boolean,default:!1},qrCodeLoginPath:{default:"/auth/qrcode-login"},registerPath:{default:"/auth/register"},showCodeLogin:{type:Boolean,default:!0},showForgetPassword:{type:Boolean,default:!0},showQrcodeLogin:{type:Boolean,default:!0},showRegister:{type:Boolean,default:!0},showRememberMe:{type:Boolean,default:!0},showThirdPartyLogin:{type:Boolean,default:!0},subTitle:{default:""},title:{default:""},submitButtonText:{default:""}},emits:["submit"],setup(t,{expose:r,emit:u}){const m=t,p=u,[y,s]=j(X({commonConfig:{hideLabel:!0,hideRequiredMark:!0},schema:B(()=>m.formSchema),showDefaultActions:!1})),i=Q(),n=`REMEMBER_ME_USERNAME_${location.hostname}`,a=localStorage.getItem(n)||"",h=Z(!!a);function P(){return T(this,null,function*(){const{valid:w}=yield s.validate(),l=yield s.getValues();w&&(localStorage.setItem(n,h.value?l==null?void 0:l.username:""),p("submit",l))})}function R(w){i.push(w)}return J(()=>{a&&s.setFieldValue("username",a)}),r({getFormApi:()=>s}),(w,l)=>(d(),L("div",{onKeydown:K(O(P,["prevent"]),["enter"])},[C(w.$slots,"title",{},()=>[c(H,null,{desc:g(()=>[v("span",ge,[C(w.$slots,"subTitle",{},()=>[_(f(t.subTitle||e(o)("authentication.loginSubtitle")),1)])])]),default:g(()=>[C(w.$slots,"title",{},()=>[_(f(t.title||`${e(o)("authentication.welcomeBack")} ðŸ‘‹ðŸ»`),1)])]),_:3})]),c(e(y)),t.showRememberMe||t.showForgetPassword?(d(),L("div",fe,[v("div",pe,[t.showRememberMe?(d(),k(e(D),{key:0,modelValue:h.value,"onUpdate:modelValue":l[0]||(l[0]=$=>h.value=$),name:"rememberMe"},{default:g(()=>[_(f(e(o)("authentication.rememberMe")),1)]),_:1},8,["modelValue"])):b("",!0)]),t.showForgetPassword?(d(),L("span",{key:0,class:"vben-link text-sm font-normal",onClick:l[1]||(l[1]=$=>R(t.forgetPasswordPath))},f(e(o)("authentication.forgetPassword")),1)):b("",!0)])):b("",!0),c(e(I),{class:ee([{"cursor-wait":t.loading},"w-full"]),loading:t.loading,"aria-label":"login",onClick:P},{default:g(()=>[_(f(t.submitButtonText||e(o)("common.login")),1)]),_:1},8,["class","loading"]),t.showCodeLogin||t.showQrcodeLogin?(d(),L("div",he,[t.showCodeLogin?(d(),k(e(I),{key:0,class:"w-1/2",variant:"outline",onClick:l[2]||(l[2]=$=>R(t.codeLoginPath))},{default:g(()=>[_(f(e(o)("authentication.mobileLogin")),1)]),_:1})):b("",!0),t.showQrcodeLogin?(d(),k(e(I),{key:1,class:"ml-4 w-1/2",variant:"outline",onClick:l[3]||(l[3]=$=>R(t.qrCodeLoginPath))},{default:g(()=>[_(f(e(o)("authentication.qrcodeLogin")),1)]),_:1})):b("",!0)])):b("",!0),C(w.$slots,"third-party-login",{},()=>[t.showThirdPartyLogin?(d(),k(ue,{key:0})):b("",!0)]),C(w.$slots,"to-register",{},()=>[t.showRegister?(d(),L("div",we,[_(f(e(o)("authentication.accountTip"))+" ",1),v("span",{class:"vben-link text-sm font-normal",onClick:l[4]||(l[4]=$=>R(t.registerPath))},f(e(o)("authentication.createAccount")),1)])):b("",!0)])],40,me))}}),xe=S({name:"Login",__name:"login",setup(t){const r=G(),u=[{label:"Super",value:"vben"},{label:"Admin",value:"admin"},{label:"User",value:"jack"}],m=B(()=>[{component:"VbenSelect",componentProps:{options:u,placeholder:o("authentication.selectAccount")},fieldName:"selectAccount",label:o("authentication.selectAccount"),rules:A().min(1,{message:o("authentication.selectAccount")}).optional().default("vben")},{component:"VbenInput",componentProps:{placeholder:o("authentication.usernameTip")},dependencies:{trigger(s,i){if(s.selectAccount){const n=u.find(a=>a.value===s.selectAccount);n&&i.setValues({password:"123456",username:n.value})}},triggerFields:["selectAccount"]},fieldName:"username",label:o("authentication.username"),rules:A().min(1,{message:o("authentication.usernameTip")})},{component:"VbenInputPassword",componentProps:{placeholder:o("authentication.password")},fieldName:"password",label:o("authentication.password"),rules:A().min(1,{message:o("authentication.passwordTip")})},{component:te(Y),fieldName:"captcha",rules:z().refine(s=>s,{message:o("authentication.verifyRequiredTip")})}]),p=oe("loginRef");function y(s){return T(this,null,function*(){r.authLogin(s).catch(()=>{var n,a;const i=(n=p.value)==null?void 0:n.getFormApi();i==null||i.setFieldValue("captcha",!1,!1),(a=i==null?void 0:i.getFieldComponentRef("captcha"))==null||a.resume()})})}return(s,i)=>(d(),k(e(be),{ref_key:"loginRef",ref:p,"form-schema":m.value,loading:e(r).loginLoading,onSubmit:y},null,8,["form-schema","loading"]))}});export{xe as _};
