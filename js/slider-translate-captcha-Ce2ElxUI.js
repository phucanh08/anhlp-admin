import{C as K}from"./index-18-lVBa-.js";import{$ as R,A as Q}from"./bootstrap-CmOIY23B.js";import{_ as Z}from"./index.vue_vue_type_script_setup_true_lang-CcnCQVvY.js";import{d as H,L as X,M as ee,l as z,b as te,r as ae,c as q,w as se,e as ie,m as D,n as p,v as f,j as k,B as ne,q as W,x as oe,A as E,u as c,ac as ce,I as re,E as S,z as le,R as de,S as ue,D as me}from"../jse/index-index-Dn7Pga_E.js";import{_ as fe}from"./page.vue_vue_type_script_setup_true_lang-B79NNVXE.js";import"./index-Cq5upoUv.js";import"./shallowequal-BOWVaEXw.js";import"./Trigger-B0Zd1YSB.js";import"./ResizeObserver.es-CDE7jhPe.js";import"./collapse-BuqCI_Sc.js";import"./Overflow-D-n6m9kG.js";import"./index-bMV-OEX7.js";import"./index-BuhGstFT.js";import"./colors-CDlQsefj.js";import"./collapseMotion-CW4DPm-L.js";import"./slide-DCDZKjHj.js";import"./useRefs-DsN55d7I.js";import"./hasIn-1TLaJpEW.js";import"./isMobile-8sZ0LT6r.js";import"./useMergedState-DAlpYor9.js";import"./isPlainObject-Cfyj4D1A.js";const pe={class:"relative flex flex-col items-center"},he={class:"border-border relative flex cursor-pointer overflow-hidden border shadow-md"},ge=["width","height"],ve=["width","height"],Ce={class:"h-15 absolute bottom-3 left-0 z-10 block w-full text-center text-xs leading-[30px] text-white"},we={key:1,class:"bg-black/30"},Te=H({__name:"index",props:X({canvasWidth:{default:420},canvasHeight:{default:280},squareLength:{default:42},circleRadius:{default:10},src:{default:""},diffDistance:{default:3},defaultTip:{default:""}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:X(["success"],["update:modelValue"]),setup(r,{emit:h}){const l=r,P=h,d=Math.PI,g=ee(r,"modelValue"),y=z("slideBarRef"),v=z("puzzleCanvasRef"),C=z("pieceCanvasRef"),t=te({dragging:!1,startTime:0,endTime:0,pieceX:0,pieceY:0,moveDistance:0,isPassing:!1,showTip:!1}),B=ae("0"),Y=q(()=>({left:B.value}));function w(e){B.value=e}const F=q(()=>t.isPassing?R("ui.captcha.sliderTranslateSuccessTip",[((t.endTime-t.startTime)/1e3).toFixed(1)]):R("ui.captcha.sliderTranslateFailTip"));function N(){t.startTime=Date.now()}function j(e){t.dragging=!0;const{moveX:a}=e;t.moveDistance=a,w(`${a}px`)}function x(){const{pieceX:e}=t,{diffDistance:a}=l;Math.abs(e-t.moveDistance)>=(a||3)?(w("0"),t.moveDistance=0):A(),t.showTip=!0,t.dragging=!1}function A(){t.isPassing=!0,t.endTime=Date.now()}se(()=>t.isPassing,e=>{if(e){const{endTime:a,startTime:s}=t,o=(a-s)/1e3;P("success",{isPassing:e,time:o.toFixed(1)})}g.value=e});function O(){const{canvasWidth:e,canvasHeight:a}=l,s=c(v),o=c(C);if(!s||!o)return;o.width=e;const i=s.getContext("2d"),n=o.getContext("2d",{willReadFrequently:!0});!i||!n||(i.clearRect(0,0,e,a),n.clearRect(0,0,e,a))}function M(){const{canvasWidth:e,canvasHeight:a,squareLength:s,circleRadius:o,src:i}=l,n=c(v),T=c(C);if(!n||!T)return;const _=n.getContext("2d"),u=T.getContext("2d",{willReadFrequently:!0});if(!_||!u)return;const m=new Image;m.crossOrigin="Anonymous",m.src=i,m.addEventListener("load",()=>{U(_,u),_.drawImage(m,0,0,e,a),u.drawImage(m,0,0,e,a);const b=s+2*o+3,G=t.pieceX,I=t.pieceY-2*o-1,J=u.getImageData(G,I,b,b);T.width=b,u.putImageData(J,0,I),w("0")})}function V(e,a){return Math.round(Math.random()*(a-e)+e)}function U(e,a){const{canvasWidth:s,canvasHeight:o,squareLength:i,circleRadius:n}=l;t.pieceX=V(i+2*n,s-(i+2*n)),t.pieceY=V(3*n,o-(i+2*n)),L(e,t.pieceX,t.pieceY,"fill"),L(a,t.pieceX,t.pieceY,"clip")}function L(e,a,s,o){const{squareLength:i,circleRadius:n}=l;e.beginPath(),e.moveTo(a,s),e.arc(a+i/2,s-n+2,n,.72*d,2.26*d),e.lineTo(a+i,s),e.arc(a+i+n-2,s+i/2,n,1.21*d,2.78*d),e.lineTo(a+i,s+i),e.lineTo(a,s+i),e.arc(a+n-2,s+i/2,n+.4,2.76*d,1.24*d,!0),e.lineTo(a,s),e.lineWidth=2,e.fillStyle="rgba(255, 255, 255, 0.7)",e.strokeStyle="rgba(255, 255, 255, 0.7)",e.stroke(),o==="clip"?e.clip():e.fill(),e.globalCompositeOperation="destination-over"}function $(){t.showTip=!1;const e=c(y);e&&(t.dragging=!1,t.isPassing=!1,t.pieceX=0,t.pieceY=0,e.resume(),O(),M())}return ie(()=>{M()}),(e,a)=>(p(),D("div",pe,[f("div",he,[f("canvas",{ref_key:"puzzleCanvasRef",ref:v,width:r.canvasWidth,height:r.canvasHeight,onClick:$},null,8,ge),f("canvas",{ref_key:"pieceCanvasRef",ref:C,width:r.canvasWidth,height:r.canvasHeight,style:ne(Y.value),class:"absolute",onClick:$},null,12,ve),f("div",Ce,[t.showTip?(p(),D("div",{key:0,class:oe({"bg-success/80":t.isPassing,"bg-destructive/80":!t.isPassing})},E(F.value),3)):W("",!0),t.dragging?W("",!0):(p(),D("div",we,E(r.defaultTip||c(R)("ui.captcha.sliderTranslateDefaultTip")),1))])]),k(Z,{ref_key:"slideBarRef",ref:y,modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=s=>g.value=s),class:"mt-5","is-slot":"",onEnd:x,onMove:j,onStart:N},ce({_:2},[re(e.$slots,(s,o)=>({name:o,fn:S(i=>[le(e.$slots,o,de(ue(i)))])}))]),1032,["modelValue"])]))}}),_e={class:"flex items-center justify-center p-4"},Ne=H({__name:"slider-translate-captcha",setup(r){function h(){Q.success("success!")}return(l,P)=>(p(),me(c(fe),{description:"用于前端简单的拼图滑块水平拖动校验场景",title:"拼图滑块校验"},{default:S(()=>[k(c(K),{class:"mb-5",title:"基本示例"},{default:S(()=>[f("div",_e,[k(c(Te),{src:"https://unpkg.com/@vbenjs/static-source@0.1.7/source/pro-avatar.webp","canvas-width":420,"canvas-height":420,onSuccess:h})])]),_:1})]),_:1}))}});export{Ne as default};
